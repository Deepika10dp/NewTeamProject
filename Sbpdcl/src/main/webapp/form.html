<!DOCTYPE html><html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Connection Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: url('https://images.unsplash.com/photo-1604079628040-fc720759f9a4?auto=format&fit=crop&w=1950&q=80') no-repeat center center fixed;
            background-size: cover;
            backdrop-filter: blur(5px);
            color: #333;
            margin: 0;
            padding: 0;
        }
        .form-wrapper {
            max-width: 1000px;
            margin: 50px auto;
            background-color: rgba(255, 255, 255, 0.97);
            padding: 50px 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
            animation: fadeIn 1s ease-in-out;
        }
        h2 {
            color: #004080;
            font-weight: 600;
        }
        label {
            font-weight: 500;
        }
        .btn-primary {
            background: linear-gradient(to right, #0066cc, #004080);
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(to right, #004080, #002855);
        }
        input, select, textarea {
            transition: box-shadow 0.3s ease;
        }
        input:focus, select:focus, textarea:focus {
            box-shadow: 0 0 8px rgba(0, 102, 204, 0.4);
            border-color: #0066cc;
        }
        .text-danger {
            font-size: 0.9rem;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* Make all form controls the same height and properly aligned */
        .form-control, .form-select {
            min-height: 45px;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        #previewSection {
            display: none;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container form-wrapper">
        <h2 class="text-center mb-4">New Connection Form</h2>
       
        <!-- ALL FORM FIELDS FROM YOUR ORIGINAL CODE (KEEP UNCHANGED) -->
        <!-- For brevity, the full original form content should go here, unchanged -->
         <form id="connectionForm" action="NewConnectionServlet" method="post" enctype="multipart/form-data" onsubmit="disableButton()">

        <p class="text-danger">*Mandatory Fields (Please upload all documents in jpeg/jpg format. 
        Document size must be less than 500 KB and PDF document size must be less than 10000 KB.)</p>

        <div class="row mb-3">
            <div class="col-md-3">
                <label for="connectionType" class="form-label">Connection Type: <span class="text-danger">*</span></label>
                <select id="connectionType" name="connectionType" class="form-select" required>
                    <option value="">--Select--</option>
                    <option value="domestic">Domestic</option>
                    <option value="commercial">Commercial</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="consumerId" class="form-label">Consumer ID:<span class="text-danger">*</span></label>
                <input type="text" id="consumerId" name="consumerId"  class="form-control" placeholder="Enter Consumer ID" required>
            </div>
        </div>

        
	        <!-- Mobile No & Email -->
	        <div class="row mb-3">
	            <div class="col-md-3">
	                <label for="mobile" class="form-label">Mobile No:<span class="text-danger">*</span></label>
	                <input type="text" id="mobile" name="mobile" class="form-control" placeholder="Enter Mobile No." required>
	            </div>
	            <div class="col-md-3">
	                <label for="email" class="form-label">Email ID:</label>
	                <input type="email" id="email" name="email" class="form-control" placeholder="Enter Email ID">
	            </div>
	        </div>


	        <!-- Address Details -->
	        <h4>Address Details:</h4>
	        <div class="row mb-3">
	            <div class="col-md-3">
	                <label for="house" class="form-label">House No:</label>
	                <input type="text" id="house" name="houseNo" class="form-control" placeholder="Enter House Number">
	            </div>
	            <div class="col-md-3">
	                <label for="street" class="form-label">Street:<span class="text-danger">*</span></label>
	                <input type="text" id="street" name="street" class="form-control" placeholder="Enter Street Name" required>
	            </div>
	             <div class="col-md-3">
	               <label for="address1" class="form-label">Address Line 1:</label>
	           	   <input type="text" id="address1" name="addressLine1" class="form-control" placeholder="Enter address" >
	            </div>
	        </div>
	        

        <!-- Address Details -->
        <h4>Address Details:</h4>
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="houseNo" class="form-label">House No:</label>
                <input type="text" id="houseNo" name="houseNo" class="form-control" placeholder="Enter House Number">
            </div>
            <div class="col-md-3">
                <label for="street" class="form-label">Street:<span class="text-danger">*</span></label>
                <input type="text" id="street" name="street" class="form-control" placeholder="Enter Street Name" required>
            </div>
             <div class="col-md-3">
               <label for="addressLine1" class="form-label">Address Line 1:</label>
           	   <input type="text" id="addressLine1" name="addressLine1" class="form-control" placeholder="Enter address" >
            </div>
        </div>
         <div class="row mb-3">

           
            <div class="col-md-3">
                 <label for="addressLine2" class="form-label">Address Line 2:</label>
            <input type="text" id="addressLine2" name="addressLine2" class="form-control" placeholder="Enter address" >
            </div>
            <div class="col-md-3">
               <label for="addressLine3" class="form-label">Address Line 3:</label>
            <input type="text" id="addressLine3" name="addressLine3" class="form-control" placeholder="Enter address" >
            </div>
            <div class="col-md-3">
               <label for="city" class="form-label">City:<span class="text-danger">*</span></label>
            <input type="text" id="city" name="city" class="form-control" placeholder="Enter City" required>
            </div>
        </div>
         <div class="row mb-3">
            <div class="col-md-3">
               <label for="pincode" class="form-label">Pin code:<span class="text-danger">*</span></label>
            <input type="text" id="pincode" name="pincode" class="form-control" placeholder="Enter Pin code" required>
            </div>
            <div class="col-md-3">
                 <label for="district" class="form-label">District:<span class="text-danger">*</span></label>
            <select id="district" name="district" class="form-select" required>
                <option value="">--Select--</option>
     
            </select>
            </div>
            <div class="col-md-3">
                <label for="block" class="form-label">Block:<span class="text-danger">*</span></label>
            	<select id="block" name="block" class="form-select" required>
               		 <option value="">--Select--</option>
               		
            	</select>
            </div>
        </div>
         <div class="row mb-3">
            
            <div class="col-md-3">
                <label for="panchayat" class="form-label">Panchayat:<span class="text-danger">*</span></label>
           		 <select id="panchayat" name="panchayat" class="form-select" required>
		              <option value="">--Select--</option>
		             
            	 </select>
            </div>
             <div class="col-md-3">
                <label for="village_ward" class="form-label">Village/Ward:<span class="text-danger">*</span></label>
	            <select id="village_ward" name="village_ward" class="form-select" required>
	                  <option value="">--Select--</option>
	       
	            </select>
            </div>
            <div class="col-md-3">
                 <label for="division" class="form-label">Division:<span class="text-danger">*</span></label>
	             <select id="division" name="division" class="form-select" disabled>
	                  <option value="">--Select--</option>
					  <option value="bhagalpur">Bhagalpur</option>
				 </select>
            </div>
        </div>
         <div class="row mb-3">
            <div class="col-md-3">
                <label for="subdivision" class="form-label">SubDivision:<span class="text-danger">*</span></label>
	            <select id="subdivision" name="subdivision" class="form-select" disabled>
	                <option value="">--Select--</option>
	           
	            </select>
            </div>
            <div class="col-md-3">
                <label for="section" class="form-label">Section:<span class="text-danger">*</span></label>
	            <select id="section" name="section" class="form-select" disabled>
	                <option value="">--Select--</option>
	              
	            </select>
            </div>
            <!-- Hidden inputs to store actual values for form submission -->
			<input type="hidden" name="division_id" id="hiddenDivision" />
			<input type="hidden" name="subdivision_id" id="hiddenSubdivision" />
			<input type="hidden" name="section_id" id="hiddenSection" />
			
            <div class="col-md-3">
                <label for="tariff" class="form-label">Tariff:<span class="text-danger">*</span></label>
	            <select id="tariff" name="tariff" class="form-select" required>
	                <option value="">--Select--</option>
	                <option value="domestic">Domestic</option>
	                <option value="commercial">Commercial</option>
	                <option value="industrial">Industrial</option>
	            </select>
            </div>
        </div>
         <div class="row mb-3">
            
            <div class="col-md-3">
                <label for="phase" class="form-label">Phase:<span class="text-danger">*</span></label>
	            <select id="phase" name="E_phase" class="form-select" required>
	                <option value="">--Select--</option>
	                <option value="single">Single</option>
	                <option value="three">Three</option>
	            </select>
            </div>
             <div class="col-md-3">
               <label for="load" class="form-label">Load:<span class="text-danger">*</span></label>
               <input type="text" id="load" name="E_load" class="form-control" placeholder="Enter load" required>
            </div>
        </div>
         
        <!-- More address fields in the same pattern -->
        
        <!-- Applicant Details -->
        <h4>Applicant Details:</h4>
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="gender" class="form-label">Gender <span class="text-danger">*</span></label>
                <select id="gender" name="gender" class="form-select" required>
                    <option value="">--Select--</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="applicantName" class="form-label">Applicant Name <span class="text-danger">*</span></label>
                <input type="text" id="applicantName" name="applicantName" class="form-control" placeholder="Enter Name" required>
            </div>
        </div>
        
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="f_hName" class="form-label">Husband/Father Name <span class="text-danger">*</span></label>
                <input type="text" id="f_hName" name="f_hName" class="form-control" placeholder="Enter Father/Husband Name" required>
            </div>
        </div>

        <!-- ID Proof -->
        <h4>ID Proof:</h4>
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="idProof" class="form-label">Document Type <span class="text-danger">*</span></label>
                <select id="idProof" name="idProof" class="form-select" required>
                    <option value="">---Select---</option>
                    <option value="passport">Passport</option>
                    <option value="pan_card">PAN Card</option>
                    <option value="aadhar_card">Aadhaar Card</option>
                    <option value="voter_id">Voter ID</option>
                    <option value="driving_license">Driving License</option>                    
                    <option value="ration_card">Ration Card</option>
					<option value="bpl_card">Below Poverty Line-BPL Card</option>
					<option value="id_government">ID Issued By Government</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="document_fileI" class="form-label"></label>
                <input type="file" id="document_fileI" name="documentFile" class="form-control" accept=".jpeg, .jpg"  >
            </div>
        </div>
        
        <!-- Address Proof -->
        <h4>Address Proof:</h4>
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="addressProof" class="form-label">Document Type <span class="text-danger">*</span></label>
                <select id="addressProof" name="addressProof" class="form-select" required>
                    <option value="">---Select---</option>
                    <option value="passport">Passport</option>
                    <option value="pan_card">PAN Card</option>
                    <option value="aadhar_card">Aadhaar Card</option>
                    <option value="voter_id">Voter ID</option>
                    <option value="driving_license">Driving License</option>                    
                    <option value="ration_card">Ration Card</option>
                    <option value="id_government">ID Issued By Government</option>
					<option value="bpl_card">Bill of Government Landline Connection</option>
					
                </select>
            </div>
            <div class="col-md-3">
                <label for="front_page" class="form-label">Front Page</label>
                <input type="file" id="front_page" name="frontPage" class="form-control" accept=".jpeg, .jpg" >
            </div>
            <div class="col-md-3">
                <label for="last_page" class="form-label">Last Page</label>
                <input type="file" id="last_page" name="lastPage" class="form-control" accept=".jpeg, .jpg" >
            </div>
        </div>
        
         <h4>Photo of Applicant:<span class="text-danger">*</span></h4>
        <div class="row mb-3">
            <div class="col-md-3">
                 <input type="file" id="photoApplicant" name="photo" class="form-control" accept="image/jpeg, image/jpg" >
            </div>
        </div>
        
         <h4>Photo of Ownership(First page of Lease Deed/Rent Agreement/Others):<span class="text-danger">*</span></h4>
        <div class="row mb-3">
            <div class="col-md-3">
                <input type="file" id="photoOwnerFirst" name="photoOwnerFirst" class="form-control" accept="image/jpeg, image/jpg" >
            </div>
        </div>
        
         <h4>Photo of Ownership(Second page of Lease Deed/Rent Agreement/Others):<span class="text-danger">*</span></h4>
        <div class="row mb-3">
            <div class="col-md-3">
                  <input type="file" id="photoOwnerSecond" name="photoOwnerSecond" class="form-control" accept="image/jpeg, image/jpg" >
            </div>
        </div>

            <!-- Submit Button 
            <div class="text-start mt-4">
                <button type="submit" class="btn btn-primary px-5 py-2">Submit</button>
            </div>
        </form>   -->


        <!-- Submit Button -->
        <div class="text-left">
            <button type="button" class="btn btn-primary" onclick="showPreview()">Submit</button>
        </div>
    </form>


    <!-- Preview Section -->
    <div id="previewSection">
        <h4 class="mt-4">Preview Your Details</h4>
        <div id="previewContent"></div>
        <button class="btn btn-secondary mt-3" onclick="goBackToForm()">Back</button>
        <button class="btn btn-success mt-3" onclick="finalSubmit()">Final Submit</button>
    </div>

</div>

	<script>
	    function showPreview() {
	        const form = document.getElementById('connectionForm');
	        const formData = new FormData(form);
	        let previewHTML = '<ul class="list-group">';
	
	        for (const [name, value] of formData.entries()) {
	            if (value && name !== 'photo' && name !== 'photoOwnerFirst' && name !== 'photoOwnerSecond' && name !== 'frontPage' && name !== 'lastPage' && name !== 'documentFile') {
	                const label = form.querySelector(`[name="${name}"]`).closest('.form-group, .col-md-3').querySelector('label').textContent;
	                previewHTML += `<li class="list-group-item"><strong>${label}</strong>: ${value}</li>`;
	            }
	        }
	
	        previewHTML += '</ul>';
	        document.getElementById('previewContent').innerHTML = previewHTML;
	        document.getElementById('connectionForm').style.display = 'none';
	        document.getElementById('previewSection').style.display = 'block';
	    }
	
	    function goBackToForm() {
	        document.getElementById('previewSection').style.display = 'none';
	        document.getElementById('connectionForm').style.display = 'block';
	    }
	
	    function finalSubmit() {
	        document.getElementById('connectionForm').submit();
	    }
	</script>

    <script>
		    $(document).ready(function () {
		        // Load districts on page load
		        $.ajax({
                url: "DivisionAutoFillServlet",
                type: "POST",
                data: { action: "getDistricts" },
                success: function (data) {
                    console.log("Fetched:", data);
                  //  $('#district').empty().append('<option value="">--Select District--</option>');
                    $.each(data, function (index, district) {
                        $('#district').append('<option value="' + district.id + '">' + district.name + '</option>');
                    });
                },
                error: function (xhr, status, error) {
                    console.error("AJAX error:", error);
                }
            });
		        // District -> Block
		        $('#district').change(function () {
		            let districtId = $(this).val();
		            clearDropdowns(['#block', '#panchayat', '#village_ward', '#division', '#subdivision', '#section']);
		            if (districtId) {
		                $.ajax({
		                    url: "DivisionAutoFillServlet?action=getBlocks&districtId=" + districtId,
		                    method: "POST",
		                    dataType: "json",
		                    success: function (response) {
		                     //   $('#block').append('<option value="">Select Block</option>');
		                        $.each(response, function (i, item) {
		                            $('#block').append('<option value="' + item.id + '">' + item.name + '</option>');
		                        });
		                    }
		                });
		            }
		        });
		
		        // Block -> Panchayat
		        $('#block').change(function () {
		            let blockId = $(this).val();
		            clearDropdowns(['#panchayat', '#village_ward', '#division', '#subdivision', '#section']);
		            if (blockId) {
		                $.ajax({
		                    url: "DivisionAutoFillServlet?action=getPanchayats&blockId=" + blockId,
		                    method: "POST",
		                    dataType: "json",
		                    success: function (response) {
		                      //  $('#panchayat').append('<option value="">Select Panchayat</option>');
		                        $.each(response, function (i, item) {
		                            $('#panchayat').append('<option value="' + item.id + '">' + item.name + '</option>');
		                        });
		                    }
		                });
		            }
		        });
		
		        // Panchayat -> Village/Ward
		        $('#panchayat').change(function () {
				    let panchayatId = $(this).val();
				    clearDropdowns(['#village_ward', '#division', '#subdivision', '#section']);
				    if (panchayatId) {
				        $.ajax({
				            url: "DivisionAutoFillServlet?action=getVillages&panchayatId=" + panchayatId,
				            method: "POST",
				            dataType: "json",
				            success: function (response) {
				              //  $('#village_ward').append('<option value="">Select Village/Ward</option>');
				                $.each(response, function (i, item) {
				                    $('#village_ward').append('<option value="' + item.id + '">' + item.name + '</option>');
				                });
				            }
				        });
				    }
				});

		
		        // Village -> Auto-fill Division/Subdivision/Section
		           // Village -> Auto-fill Division/Subdivision/Section
			    $(document).ready(function () {
				    $('#village_ward').change(function () {
				        let villageId = $(this).val();
				
				        if (villageId) {
				            $.ajax({
				                url: "DivisionAutoFillServlet?action=getHierarchy&villageId=" + villageId,
				                method: "POST",
				                dataType: "json",
				                success: function (data) {
				                    // Clear old options
				                    $('#division').empty();
				                    $('#subdivision').empty();
				                    $('#section').empty();
				
				                    // Fill & disable Division
				                    $('#division').append('<option value="' + data.division.id + '" selected>' + data.division.name + '</option>');
				                    $('#division').prop('disabled', true);
				                    $('#hiddenDivision').val(data.division.id);
				
				                    // Fill & disable Sub Division
				                    $('#subdivision').append('<option value="' + data.subdivision.id + '" selected>' + data.subdivision.name + '</option>');
				                    $('#subdivision').prop('disabled', true);
				                    $('#hiddenSubdivision').val(data.subdivision.id);
				
				                    // Fill & disable Section
				                    $('#section').append('<option value="' + data.section.id + '" selected>' + data.section.name + '</option>');
				                    $('#section').prop('disabled', true);
				                    $('#hiddenSection').val(data.section.id);
				                },
				                error: function (xhr, status, error) {
				                    console.error("Error loading data:", error);
				                }
				            });
				        } else {
				            // Reset selects and hidden values
				            $('#division, #subdivision, #section').empty().append('<option value="">-- Select --</option>').prop('disabled', true);
				            $('#hiddenDivision, #hiddenSubdivision, #hiddenSection').val('');
				        }
				    });
				});

		        

			    function clearDropdowns(ids) {
			        ids.forEach(function (id) {
			            $(id).empty().append('<option value="">--Select--</option>');
			        });
			    }

		    });

	  
	        	function disableButton(){
	        		document.getElementById('submitBtn').disabled=true;
	        	}
        </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	
</body>
</html>